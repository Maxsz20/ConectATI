{% extends "app/base.html" %}
{% load static %}

{% block title %}Chat{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/chat_conectati.css' %}" />
{% endblock %}

{% block contenido %}
    <div class="area-mensajes">
        <div class="fila-encabezados">
            <div class="encabezado-lista">
                <h2>Mensajes</h2>
            </div>
            <div class="encabezado-chat">
                <img src="https://i.pravatar.cc/150?img=47" alt="Ana GarcÃ­a" />
                <strong>Ana GarcÃ­a</strong>
                <small id="chat-usuario">@ang</small>
            </div>
        </div>

        <div class="titulo-mobile">
            <h2>Mensajes</h2>
        </div>

        <div class="encabezado-chat-mobile" style="display: none;">
            <i class="fas fa-arrow-left btn-volver-chat"></i>
            <img id="chat-avatar" src="" alt="Avatar usuario" />
            <div class="nombre-chat-info">
                <strong id="chat-nombre">Nombre</strong>
                <small id="chat-usuario">@usuario</small>
            </div>
        </div>

        <div class="contenedor-mensajes">
            <div class="columna-central">
                <section class="chat-list">
                    <div class="chat-user">
                        <div class="chat-user-info">
                            <img src="https://i.pravatar.cc/150?img=47" alt="Ana GarcÃ­a" />
                            <span>
                                @anag<br />
                                <small>Ana GarcÃ­a</small>
                            </span>
                        </div>
                        <i class="fas fa-trash" title="Eliminar chat"></i>
                    </div>
                    <div class="chat-user">
                        <div class="chat-user-info">
                            <img src="https://i.pravatar.cc/150?img=47" alt="Ana GarcÃ­a" />
                            <span>
                                @anag<br />
                                <small>Ana GarcÃ­a</small>
                            </span>
                        </div>
                        <i class="fas fa-trash" title="Eliminar chat"></i>
                    </div>
                    <div class="chat-user">
                        <div class="chat-user-info">
                            <img src="https://i.pravatar.cc/150?img=47" alt="Ana GarcÃ­a" />
                            <span>
                                @anag<br />
                                <small>Ana GarcÃ­a</small>
                            </span>
                        </div>
                        <i class="fas fa-trash" title="Eliminar chat"></i>
                    </div>
                    <div class="chat-user">
                        <div class="chat-user-info">
                            <img src="https://i.pravatar.cc/150?img=47" alt="Ana GarcÃ­a" />
                            <span>
                                @anag<br />
                                <small>Ana GarcÃ­a</small>
                            </span>
                        </div>
                        <i class="fas fa-trash" title="Eliminar chat"></i>
                    </div>

                    <div class="chat-user">
                        <div class="chat-user-info">
                            <img src="https://i.pravatar.cc/150?img=21" alt="Maria Per" />
                            <span>
                                @marperez<br />
                                <small>Maria Perez</small>
                            </span>
                        </div>
                        <i class="fas fa-trash" title="Eliminar chat"></i>
                    </div>
                </section>
                
                <section class="solicitudes-chat">
                    <h3>Solicitudes de Mensajes</h3>
                    <div class="item-solicitud">
                        <img src="https://i.pravatar.cc/150?img=21" alt="Carlos" />
                        <div class="contenido">
                            <strong>@carlosm</strong> <span class="nombre">Carlos Mendoza</span>
                            <p>Â¿Podemos hablar por aquÃ­?</p>
                        </div>
                        <div class="acciones">
                            <i class="fas fa-check aceptar" title="Aceptar"></i>
                            <i class="fas fa-times rechazar" title="Rechazar"></i>
                        </div>
                    </div>
                    <div class="item-solicitud">
                        <img src="https://i.pravatar.cc/150?img=21" alt="Carlos" />
                        <div class="contenido">
                            <strong>@carlosm</strong> <span class="nombre">Carlos Mendoza</span>
                            <p>Â¿Podemos hablar por aquÃ­?</p>
                        </div>
                        <div class="acciones">
                            <i class="fas fa-check aceptar" title="Aceptar"></i>
                            <i class="fas fa-times rechazar" title="Rechazar"></i>
                        </div>
                    </div>
                </section>
            </div>

            <div class="conversacion">
                <div class="chat-mensajes">
                    <div class="mensaje recibido">
                        Â¿QuÃ© deberÃ­amos hacer?
                    </div>
                    <div class="mensaje enviado">
                        Â¡Empecemos!
                    </div>
                    <div class="mensaje recibido">
                        Â¿QuÃ© deberÃ­amos hacer?
                    </div>
                    <div class="mensaje enviado">
                        Â¡Empecemos!
                    </div>
                    <div class="mensaje recibido">
                        Â¿QuÃ© deberÃ­amos hacer?
                    </div>
                    <div class="mensaje enviado">
                        Â¡Empecemos!
                    </div>
                    <div class="mensaje recibido">
                        Â¿QuÃ© deberÃ­amos hacer?
                    </div>
                </div>
                <div class="chat-input">
                    <i class="fas fa-camera"></i>
                    <input type="text" placeholder="Escribir mensaje..." />
                    <i class="fas fa-microphone"></i>
                    <i class="fas fa-image"></i>
                    <i class="fas fa-paper-plane"></i>
                </div>
            </div>
        </div>
    </div>

    <a href="{% url 'post_mobile' %}">
        <div class="boton-publicar-mobile">
            <div class="burbuja">
                <span class="texto">Publicar</span>
                <div class="icono"><i class="fas fa-plus"></i></div>
            </div>
        </div>
    </a>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const isMobile = () => window.innerWidth <= 768;

        const chatItems = document.querySelectorAll(".chat-user");
        const chatList = document.querySelector(".chat-list");
        const conversacion = document.querySelector(".conversacion");
        const encabezadoLista = document.querySelector(".encabezado-lista");
        const tituloMobile = document.querySelector(".titulo-mobile");
        const headerMobile = document.querySelector(".header-mobile");
        const chatInput = document.querySelector(".chat-input");
        const menuMobile = document.querySelector(".menu-mobile");
        const encabezadoChatMobile = document.querySelector(".encabezado-chat-mobile");
        const avatarMobile = document.getElementById("chat-avatar");
        const nombreMobile = document.getElementById("chat-nombre");
        const usuarioMobile = document.getElementById("chat-usuario");
        const botonPublicar = document.querySelector(".boton-publicar-mobile");
        const columnaCentral = document.querySelector(".columna-central");
        const avatarDesktop = document.querySelector(".encabezado-chat img");
        const nombreDesktop = document.querySelector(".encabezado-chat strong");

        // Volver atrÃ¡s
        const btnVolver = encabezadoChatMobile.querySelector(".btn-volver-chat");
        btnVolver.addEventListener("click", () => {
            chatList.style.display = "block";
            conversacion.style.display = "none";
            encabezadoChatMobile.style.display = "none";
            encabezadoLista.style.display = "flex";
            headerMobile.style.display = "flex";
            tituloMobile.style.display = "block";
            chatInput.style.display = "none";
            menuMobile.style.display = "flex";
            botonPublicar.style.display = "flex";
            columnaCentral.style.display = "block";
        });

        // Click en cualquier chat
        chatItems.forEach(item => {
            item.addEventListener("click", () => {
                const img = item.querySelector("img");
                const nameSpan = item.querySelector("span");
                const smallElement = item.querySelector("small"); // Corrected to target small element
                const usuario = smallElement.textContent.trim(); // Get text content

                const nombreTexto = nameSpan.childNodes[0].nodeValue.trim();

                // ðŸ‘‰ Actualizar encabezado mobile
                avatarMobile.src = img.src;
                avatarMobile.alt = img.alt;
                nombreMobile.textContent = nombreTexto;
                usuarioMobile.textContent = usuario;

                // ðŸ‘‰ Actualizar encabezado desktop
                avatarDesktop.src = img.src;
                avatarDesktop.alt = img.alt;
                nombreDesktop.textContent = nombreTexto;

                if (isMobile()) {
                    chatList.style.display = "none";
                    conversacion.style.display = "flex";
                    encabezadoLista.style.display = "none";
                    encabezadoChatMobile.style.display = "flex";
                    headerMobile.style.display = "none";
                    tituloMobile.style.display = "none";
                    menuMobile.style.display = "none";
                    chatInput.style.display = "flex";
                    botonPublicar.style.display = "none";
                    columnaCentral.style.display = "none";
                }
            });
        });

        // Reset on resize
        window.addEventListener("resize", () => {
            if (!isMobile()) {
                chatList.style.display = "";
                conversacion.style.display = "";
                encabezadoLista.style.display = "";
                encabezadoChatMobile.style.display = "none";
                headerMobile.style.display = "";
                tituloMobile.style.display = "";
                chatInput.style.display = "";
                menuMobile.style.display = "";
                botonPublicar.style.display = "";
                columnaCentral.style.display = "";
            }
        });
    });

    function scrollToBottom() {
        const chatMensajes = document.querySelector('.chat-mensajes');
        if (chatMensajes) {
            chatMensajes.scrollTop = chatMensajes.scrollHeight;
        }
    }

    // Ejecuta al cargar
    window.addEventListener('load', scrollToBottom);

    // TambiÃ©n cada vez que se abra un chat
    const chatItems = document.querySelectorAll(".chat-user");
    chatItems.forEach(item => {
        item.addEventListener("click", () => {
            setTimeout(scrollToBottom, 100); // Espera leve para asegurar que el contenido estÃ© visible
        });
    });
</script>
{% endblock %}