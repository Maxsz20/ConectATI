{% extends "app/base.html" %}
{% load static %}

{% block title %}Publicación{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/publicacion_conectati.css' %}">
{% endblock %}

{% block titulo_pagina %}Publicación{% endblock %}
{% block titulo_pagina_mobile %}Publicación{% endblock %}

{% block contenido2 %}
<div class="contenedor-info">
    <section class="publicacion">
    <article class="post-principal">
        <div class="usuario">
        <img src="https://i.pravatar.cc/150?img=20" alt="Carlos Mendoza" />
        <div class="datos">
            <strong>Carlos Mendoza</strong>
            <span>@carlosm</span>
        </div>
        <button class="seguir">Añadir</button>
        </div>
        <p class="contenido-post">Lorem ipsum dolor sit amet, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.</p>
        <img class="imagen-post" src="{% static 'images/gato.jfif' %}" alt="Imagen de la publicación">
        <div class="acciones">
        <span><i class="far fa-star"></i> 12</span>
        <span><i class="far fa-comment comentario-btn" data-usuario="@carlosm"></i> 3</span>
        </div>
        <div class="meta">3:15 PM · 16/06/2025</div>
    </article>

    <div class="form-respuesta">
        <img src="https://i.pravatar.cc/150?img=47" alt="Mi perfil" />
        <input type="text" placeholder="Postea tu respuesta" />
        <button class="btn-responder">Responder</button>
    </div>

    <div class="comentarios">
        <h3>Comentarios</h3>

        <div class="comentario">
        <img src="https://i.pravatar.cc/150?img=47" alt="Daniel Rojas" />
        <div class="contenido">
            <div class="usuario">
            <strong>Daniel Rojas</strong>
            <span>@danroj · 2h</span>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut enim ad minim veniam.</p>
            <div class="acciones">
            <span><i class="far fa-star"></i> 2</span>
            <span><i class="far fa-comment comentario-btn" data-usuario="@danroj"></i> 1</span>
            </div>
            <div class="meta">3:15 PM · 16/06/2025</div>
        </div>
        </div>

        <div class="comentario">
        <img src="https://i.pravatar.cc/150?img=21" alt="Valentina García" />
        <div class="contenido">
            <div class="usuario">
            <strong>Valentina García</strong>
            <span>@valenng · 5h</span>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
            <div class="acciones">
            <span><i class="far fa-star"></i> 3</span>
            <span><i class="far fa-comment comentario-btn" data-usuario="@valenng"></i> 0</span>
            </div>
            <div class="meta">3:15 PM · 16/06/2025</div>
        </div>
        </div>
    </div>
    </section>
    {% block panel_lateral %}
    <div class="panel-lateral">
    <h3>Mensajes</h3>
    {% for i in "12" %}
    <a href="{% url 'chat' %}">
        <div class="mensaje-preview">
        <img src="https://i.pravatar.cc/150?img=47" alt="Ana" />
        <div class="mensaje-info">
            <div class="usuario">
            <span class="nombre">Ana García</span>
            <span>@anag · 4h</span>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        </div>
        <i class="fas fa-envelope"></i>
        </div>
    </a>
    {% endfor %}

    <h3>Solicitudes de mensajes</h3>
    {% for i in "12" %}
    <div class="solicitud-preview">
        <img src="https://i.pravatar.cc/150?img=21" alt="Carlos" />
        <div class="mensaje-info">
        <div class="usuario">
            <span class="nombre">Carlos Mendoza</span>
            <span>@carlosm · 3h</span>
        </div>
        <p>¿Podemos hablar por aquí?</p>
        </div>
        <div class="acciones">
        <a href="{% url 'chat' %}"><i class="fas fa-check aceptar" title="Aceptar"></i></a>
        <i class="fas fa-times rechazar" title="Rechazar"></i>
        </div>
    </div>
    {% endfor %}
    </div>
    {% endblock %}
{% endblock %}

{% block extra_body_content %}
<div class="modal-respuesta" id="modalRespuesta">
  <div class="contenido-modal">
    <div class="barra-superior-modal">
      <a href="#" class="cancelar-modal" onclick="cerrarModal()">Cancelar</a>
      <button class="btn-subir">Subir</button>
    </div>

    <div class="publicacion-respuesta">
      <img src="https://i.pravatar.cc/150?img=12" alt="Carlos Mendoza" />
      <div class="contenido">
        <strong>Carlos Mendoza</strong>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut enim ad minim veniam.</p>
      </div>
    </div>

    <div class="campo-respuesta">
      <img src="https://i.pravatar.cc/150?img=9" alt="Usuario actual" />
      <div class="respuesta-input">
        <span class="respondiendo-a">Respondiendo a <span>@carlosm</span></span>
        <textarea placeholder="Escribe tu respuesta"></textarea>
      </div>
    </div>

    <div class="acciones-respuesta">
      <i class="fas fa-camera"></i>
      <i class="fas fa-image"></i>
      <i class="fas fa-moon"></i>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const botonesComentar = document.querySelectorAll(".comentario-btn");
    const modal = document.getElementById("modalRespuesta");

    botonesComentar.forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const isMobile = window.innerWidth <= 876;

        if (isMobile) {
          window.location.href = "{% url 'reply_mobile' %}";
        } else {
          abrirModalRespuesta();
        }
      });
    });

    document.addEventListener("click", (e) => {
      if (modal.style.display === "flex" &&
          !document.querySelector(".contenido-modal").contains(e.target)) {
        cerrarModal();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        cerrarModal();
      }
    });
  });

  function abrirModalRespuesta() {
    document.getElementById("modalRespuesta").style.display = "flex";
  }

  function cerrarModal() {
    document.getElementById("modalRespuesta").style.display = "none";
  }
</script>
{% endblock %}
